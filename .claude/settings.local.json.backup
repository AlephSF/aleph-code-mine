{
  "permissions": {
    "allow": [
      "Bash(npx scc:*)",
      "Bash(find:*)",
      "Bash(ls:*)",
      "Bash(git -C /Users/oppodeldoc/code/airbnb log --oneline -15)",
      "Bash(grep:*)",
      "Bash(du -sh:*)",
      "Bash(wc:*)",
      "Bash(/tmp/ripplecom-sanity-structure.md << 'EOF'\n# Ripplecom Nextjs - Sanity.js Structural Analysis\n\n**Document Generated:** February 11, 2026  \n**Repository:** /Users/oppodeldoc/code/ripplecom-nextjs  \n**Sanity Studio Location:** `/apps/sanity-studio`\n\n---\n\n## Executive Summary\n\nThe ripplecom-nextjs monorepo uses Sanity.io v4.3.0 as its headless CMS, with a well-organized studio application managing complex content modeling for a modern marketing website. The Sanity implementation features 15 core document types, 13 reusable field/object types, and 15 legacy component schemas for a Contentful migration. The codebase demonstrates mature Sanity patterns including presentation tool integration, custom plugins, and sophisticated Algolia search indexing.\n\n---\n\n## 1. Monorepo Structure\n\n### Overall Layout\n```\n/Users/oppodeldoc/code/ripplecom-nextjs/\n├── apps/\n│   ├── ripple-web/                 # Next.js frontend application\n│   └── sanity-studio/              # Sanity CMS studio \\(FOCUS\\)\n├── packages/\n├── docs/\n├── node_modules/\n├── package.json \\(root workspace\\)\n└── turbo.json                       # Turbo monorepo configuration\n```\n\n### Monorepo Type\n- **Package Manager:** NPM with Turbo monorepo configuration\n- **Workspace Structure:** Multi-app monorepo with shared packages\n- **Sanity Studio Package Name:** `@ripplecom/sanity-studio`\n- **Sanity Studio Version:** 1.0.0 \\(private package\\)\n\n---\n\n## 2. Sanity Studio Directory Structure\n\n### Core Architecture\n```\n/apps/sanity-studio/\n├── sanity.config.ts                # Main Sanity configuration\n├── sanity.cli.ts                   # CLI configuration\n├── environment.ts                  # Environment variable definitions\n├── sanity.types.ts                 # Generated TypeScript types \\(48KB\\)\n├── schema.json                     # Generated schema export \\(386KB\\)\n│\n├── schemaTypes/                    # Core schema definitions \\(78 files, 95 TS files\\)\n│   ├── index.ts                    # Schema entry point \\(exports all types\\)\n│   ├── documents/                  # Document types \\(16 files\\)\n│   │   ├── blogPost.ts\n│   │   ├── caseStudy.ts\n│   │   ├── category.ts\n│   │   ├── event.ts\n│   │   ├── leadGeneration.ts\n│   │   ├── page.ts\n│   │   ├── pageSubnav.ts\n│   │   ├── person.ts\n│   │   ├── pressRelease.ts\n│   │   ├── redirect.ts\n│   │   ├── section.ts\n│   │   ├── tag.ts\n│   │   ├── thankYouPage.ts\n│   │   ├── legacyCtaCard.ts\n│   │   ├── legacyQuote.ts\n│   │   └── video.ts\n│   │\n│   ├── components/                 # Reusable UI components \\(15 files\\)\n│   │   ├── bioModal.ts\n│   │   ├── button.ts\n│   │   ├── cardGrid.ts\n│   │   ├── collapsibleSection.ts\n│   │   ├── contentDetailModal.ts\n│   │   ├── ctaCard.ts\n│   │   ├── ctaSection.ts\n│   │   ├── eventCard.ts\n│   │   ├── heroSection.ts\n│   │   ├── imageSection.ts\n│   │   ├── investmentsCard.ts\n│   │   ├── modalLogo.ts\n│   │   ├── newsletterSignup.ts\n│   │   ├── spacer.ts\n│   │   └── textSection.ts\n│   │\n│   ├── fields/                     # Reusable field types \\(12 files\\)\n│   │   ├── bodyText.tsx\n│   │   ├── codeSnippet.ts\n│   │   ├── contentSlug.ts\n│   │   ├── imageWithAlt.ts\n│   │   ├── link.tsx                # Multi-type link handler \\(internal/external/email/phone/file/anchor\\)\n│   │   ├── path.ts\n│   │   ├── pressReleaseRichText.ts\n│   │   ├── quote.ts\n│   │   ├── richText.ts             # Portable text with inline media\n│   │   ├── stat.ts\n│   │   ├── table.ts                # Table block component\n│   │   └── video.ts\n│   │\n│   ├── objects/                    # Embedded data structures \\(13 files\\)\n│   │   ├── blogMeta.ts\n│   │   ├── boilerplate.ts\n│   │   ├── contactInfo.ts\n│   │   ├── country.ts\n│   │   ├── footerSection.ts\n│   │   ├── hoverLayoutItem.ts\n│   │   ├── metaFields.ts\n│   │   ├── navigationColumn.ts\n│   │   ├── navigationDropdown.ts\n│   │   ├── navigationItem.ts\n│   │   ├── publishingMeta.ts\n│   │   ├── seo.ts                  # Comprehensive SEO meta \\(OG, Twitter, canonical, noindex\\)\n│   │   └── valueProps.ts\n│   │\n│   ├── globals/                    # Site-wide singleton configurations \\(7 files\\)\n│   │   ├── homepage.ts\n│   │   ├── navigation.ts\n│   │   ├── footerNavigation.ts\n│   │   ├── seoMetadata.ts           # Default SEO settings\n│   │   ├── regions.ts\n│   │   ├── rlusdBalance.ts\n│   │   └── globalOptions.ts\n│   │\n│   └── legacy/                     # Contentful migration schemas \\(14+ files\\)\n│       ├── sections/               # Legacy section components\n│       │   ├── agendaSection.ts\n│       │   ├── attestationsSection.ts\n│       │   ├── bioModalList.ts\n│       │   ├── collapsibleSectionList.ts\n│       │   ├── contentLibrarySection.ts\n│       │   ├── faqSection.ts\n│       │   ├── hoverLayoutItem.ts\n│       │   ├── hoverListsSection.ts\n│       │   ├── investmentsSection.ts\n│       │   ├── marqueeLogoSection.ts\n│       │   ├── modalLogosSection.ts\n│       │   ├── quotesSection.ts\n│       │   ├── splitColumnTextImageSection.ts\n│       │   ├── timelineSection.ts\n│       │   ├── valuePropsSection.ts\n│       │   └── videoList.ts\n│       └── index.ts                # Legacy schema export\n│\n├── structure/                      # Studio UI structure configuration\n│   └── index.ts                    # Custom structure resolver\n│\n├── src/                            # Utility functions\n│   └── utils/\n│       ├── getPreviewUrl.ts        # Dynamic preview URL resolution\n│       └── getAllowOrigins.ts      # CORS origin configuration for presentation tool\n│\n├── lib/                            # Utility libraries\n│   └── algolia/                    # Search indexing integration\n│       ├── index.ts                # Algolia export barrel\n│       ├── client.ts               # Algolia client initialization\n│       ├── transform.ts            # Document transformation for Algolia\n│       ├── indexing.ts             # Batch indexing logic\n│       └── types.ts                # TypeScript types for Algolia integration\n│\n├── scripts/                        # Utility scripts\n│   └── algolia-sync.ts             # Full reindex script with verify/clear operations\n│\n├── migrations/                     # Data migrations\n│   └── migrate-string-to-portable-text/\n│       └── index.ts                # Lead generation subtitle migration\n│\n├── static/                         # Static assets\n├── dist/                           # Build output\n│\n├── package.json                    # Dependencies and scripts\n├── tsconfig.json                   # TypeScript configuration\n├── sanity.types.ts                 # Generated type definitions\n└── vercel.json                     # Vercel deployment configuration\n```\n\n### Directory Statistics\n- **Total TypeScript/TSX Files:** 95 files\n- **Total Lines of Code:** ~12,974 lines\n- **Schema Types:** 78 schema definition files\n- **Main Structure Size:** /schemaTypes \\(core schemas\\), ~4.2 MB\n\n---\n\n## 3. Key Dependencies & Versions\n\n### Package.json Analysis\n\n```json\n{\n  \"name\": \"@ripplecom/sanity-studio\",\n  \"version\": \"1.0.0\",\n  \"private\": true,\n  \"main\": \"package.json\"\n}\n```\n\n### Core Sanity Dependencies\n| Package | Version | Purpose |\n|---------|---------|---------|\n| `sanity` | ^4.3.0 | Core Sanity CMS framework |\n| `@sanity/client` | ^7.12.0 | API client for Sanity queries |\n| `@sanity/vision` | ^3.19.1 | GROQ query IDE/debugger |\n| `@sanity/color-input` | ^4.0.6 | Color picker input component |\n| `@sanity/table` | ^2.0.0 | Table editor component |\n| `@sanity/icons` | ^3.7.4 | Icon library |\n\n### Plugin Ecosystem\n| Plugin | Version | Purpose |\n|--------|---------|---------|\n| `sanity-plugin-media` | ^4.0.0 | Enhanced media management |\n\n### Build & Runtime\n| Package | Version | Purpose |\n|---------|---------|---------|\n| `react` | ^19.2 | React framework |\n| `react-dom` | ^19.2 | React DOM renderer |\n| `styled-components` | ^6.1.18 | CSS-in-JS styling |\n| `@sanity/migrate` | ^4.10.2 | Data migration framework |\n\n### Integration Tools\n| Package | Version | Purpose |\n|---------|---------|---------|\n| `algoliasearch` | ^4.24.0 | Algolia search integration |\n| `dotenv` | ^16.4.5 | Environment variable loading |\n| `dotenv-cli` | ^7.4.2 | CLI environment variable support |\n| `tsx` | ^4.19.2 | TypeScript execution for scripts |\n\n### Development Dependencies\n| Package | Version | Purpose |\n|---------|---------|---------|\n| `typescript` | ^5.8 | TypeScript compiler |\n| `@types/react` | ^19.2 | React type definitions |\n| `@repo/eslint-config` | ^0.0.0 | Monorepo ESLint configuration |\n\n### Notable Absence\n- **Presentation Tool:** Integrated via sanity/presentation \\(built-in, no separate package needed\\)\n- **Webhook Support:** Configured via Sanity deployment settings\n\n---\n\n## 4. Sanity Configuration Files\n\n### sanity.config.ts \\(7.8 KB\\)\n\n**Plugins Configured:**\n1. **structureTool** - Custom studio navigation structure\n2. **colorInput\\(\\)** - Color field picker\n3. **media\\(\\)** - Enhanced media management from sanity-plugin-media\n4. **table\\(\\)** - Table block editor\n5. **visionTool\\(\\)** - GROQ query IDE\n6. **presentationTool\\(\\)** - Live preview in presentation mode\n\n**Key Settings:**\n\n```typescript\n// Authentication\nauth: createAuthStore\\({\n  mode: \"append\",\n  loginMethod: \"dual\",\n  providers: [\n    {\n      name: \"saml\",\n      title: \"Ripple Okta\",\n      url: \"https://api.sanity.io/v2021-10-01/auth/saml/login/44054204\"\n    }\n  ]\n}\\)\n\n// Singleton Documents \\(hidden from create menu\\)\nsingletonTypes = new Set\\([\n  \"defaultSeo\",\n  \"footerNavigation\",\n  \"globalOptions\",\n  \"homepage\",\n  \"regions\",\n  \"rlusdBalance\"\n]\\)\n\n// Presentation Tool Configuration\npresentationTool: {\n  previewUrl: {\n    origin: getPreviewUrl\\(\\),  // Dynamic Vercel/localhost resolution\n    previewMode: {\n      enable: \"/api/draft-mode/presentation-tool\"\n    }\n  },\n  allowOrigins: getAllowOrigins\\(\\),  // Environment-aware CORS\n  \n  // Main Documents \\(editorial content with live preview\\)\n  mainDocuments: [\n    { route: \"/customer-case-study/:slug\", filter: '_type == \"caseStudy\"' },\n    { route: \"/lp/:slug\", filter: '\\(_type == \"leadGeneration\" || _type == \"thankYouPage\"\\)' },\n    { route: \"/insights/:slug\", filter: '_type == \"blogPost\"' },\n    { route: \"/ripple-press/:slug\", filter: '_type == \"pressRelease\"' }\n  ],\n  \n  // Location Resolvers \\(define preview paths per document type\\)\n  locations: {\n    leadGeneration: {\n      select: { title, slug, thankYouPageEnabled },\n      resolve: \\(doc\\) => [...preview locations for LP and thank you page...]\n    },\n    blogPost: { ... },\n    caseStudy: { ... },\n    pressRelease: { ... },\n    thankYouPage: { ... }\n  }\n}\n```\n\n**Project Configuration:**\n- **Project ID:** ior4a5y3\n- **Dataset:** production\n- **API Version:** 2025-11-11 \\(latest\\)\n\n### sanity.cli.ts \\(377 bytes\\)\n\n```typescript\nexport default defineCliConfig\\({\n  api: {\n    projectId: sanityProjectId,\n    dataset: sanityDataset,\n  },\n  deployment: {\n    autoUpdates: false,  // Manual update control\n  },\n}\\)\n```\n\n### environment.ts \\(499 bytes\\)\n\n```typescript\nexport const sanityProjectId = process.env.SANITY_STUDIO_PROJECT_ID || \"ior4a5y3\"\nexport const sanityDataset = process.env.SANITY_STUDIO_DATASET || \"production\"\nexport const sanityApiVersion = process.env.SANITY_STUDIO_SANITY_API_VERSION || \"2025-11-11\"\n\n// Algolia Configuration\nexport const algoliaAppId = process.env.ALGOLIA_APP_ID\nexport const algoliaAdminApiKey = process.env.ALGOLIA_ADMIN_API_KEY\nexport const algoliaIndexName = process.env.ALGOLIA_INDEX_NAME || \"prod_ripplecom_nextjs\"\n```\n\n### vercel.json\n\nVercel-specific deployment configuration for the Sanity studio.\n\n---\n\n## 5. Schema Organization & Content Modeling\n\n### Document Types \\(16 total\\)\n\n#### Primary Content Documents\n\n**1. blogPost**\n- **Icon:** DocumentTextIcon\n- **Groups:** Content, Meta, SEO\n- **Fields:**\n  - title \\(required, max 180 chars\\)\n  - slug \\(contentSlug\\)\n  - featuredImage \\(image\\)\n  - content \\(richText, required\\)\n  - categories \\(array of references to category\\)\n  - tags \\(array of references to tag\\)\n  - meta \\(globalMeta\\)\n  - excludeFromWebsiteSearch \\(boolean\\)\n  - seo \\(seo object\\)\n- **Preview:** Shows title, author, and slug path\n- **Orderings:** By published date \\(desc/asc\\), title A-Z, last modified\n- **Search Integration:** Indexed in Algolia\n\n**2. caseStudy**\n- **Icon:** FaceHappyIcon\n- **Groups:** Content, Customer Info, Metrics & Results, Media, SEO\n- **Fields:**\n  - title \\(required\\)\n  - slug \\(contentSlug\\)\n  - heroTitle \\(required\\)\n  - tags \\(array of references\\)\n  - customerDescription \\(required, 40-256 chars\\)\n  - goal \\(text, 70-450 chars\\)\n  - solution \\(required, 90-450 chars\\)\n  - stats \\(array of stat, max 4\\)\n  - whiteLogo \\(image, required\\)\n  - colorLogo \\(image, required\\)\n  - quote \\(quote object\\)\n  - video \\(video object\\)\n  - summaryTitle & summaryDescription\n  - excludeFromWebsiteSearch\n  - seo\n- **Preview:** Shows customer description and logo\n- **Search Integration:** Indexed in Algolia\n\n**3. pressRelease**\n- **Fields:** Similar structure to blogPost with custom richText variant\n- **Search Integration:** Indexed in Algolia\n\n**4. page**\n- **Purpose:** General content pages with flexible builder\n- **Search Integration:** Indexed in Algolia\n\n**5. leadGeneration**\n- **Purpose:** Landing pages with lead form and optional thank you page\n- **Special Fields:** thankYouPage \\(object with enabled flag\\)\n- **Presentation Tool Integration:** Dual preview \\(main page + thank you\\)\n- **Search Integration:** Indexed in Algolia\n\n**6. thankYouPage**\n- **Embedded in:** leadGeneration documents\n- **Presentation Tool Integration:** Direct preview from lead generation page\n\n**7. section \\(Legacy\\)**\n- **Purpose:** Container for legacy Contentful sections\n- **Contains:** Array of legacy section type objects\n- **Status:** Active but being phased out\n\n#### Supporting Document Types\n\n**8. category** - Content categorization\n**9. tag** - Flexible content tagging\n**10. person** - Team member profiles\n**11. event** - Event listings\n**12. pageSubnav** - Secondary navigation for pages\n\n#### Legacy/Deprecated Documents\n\n**13. legacyCtaCard** - Deprecated CTA component\n**14. legacyQuote** - Deprecated quote format\n**15. legacyVideo** - Deprecated video document type\n**16. video** - Modern video field type \\(also a document type\\)\n\n### Object Types \\(13 total\\)\n\n**Data Structure Objects \\(Non-document\\):**\n\n1. **seo** - Comprehensive SEO metadata\n   - Page title \\(max 160 chars\\)\n   - Meta description \\(max 360 chars\\)\n   - Keywords \\(array\\)\n   - OG title, OG description, OG image\n   - Twitter Card type\n   - Canonical URL\n   - noIndex, noFollow booleans\n\n2. **link** / **linkOptional** - Flexible link handler\n   - Link type: internal | external | email | phone | file | anchor\n   - Type-specific fields \\(internalLink reference, externalUrl, email, phone, file, anchor\\)\n   - openInNewTab boolean\n   - ariaLabel for accessibility\n   - rel attributes \\(nofollow, noopener, noreferrer, sponsored, ugc\\)\n\n3. **blogMeta** - Publishing metadata for blog posts\n   - author \\(array of references\\)\n   - publishedAt \\(date\\)\n   - lastModified \\(date\\)\n\n4. **publishingMeta** - General publishing info\n   - Similar to blogMeta structure\n\n5. **metaFields** - Global meta information\n   - Combined author, publishedAt, lastModified\n\n6. **navigationItem** - Single navigation link\n   - title, slug, link, icon, children\n\n7. **navigationColumn** - Column in mega menu\n   - title, items \\(array of navigationItem\\)\n\n8. **navigationDropdown** - Dropdown menu\n   - title, columns \\(array of navigationColumn\\)\n\n9. **contactInfo** - Contact details object\n   - name, email, phone, address\n\n10. **country** - Localization object\n    - name, code, region\n\n11. **footerSection** - Footer area definition\n    - title, content, links\n\n12. **hoverLayoutItem** - Layout item for hover interactions\n    - title, description, image, link\n\n13. **valueProps** - Value proposition object\n    - title, description, icon\n\n### Component Types \\(15 total\\) - Reusable UI Components\n\nAll marked as `type: \"object\"` so they render as embeddable components:\n\n1. **heroSection** - Hero banner with headline, subheadline, background image, CTAs\n2. **ctaSection** - Call-to-action container with headline and buttons\n3. **textSection** - Rich text content block\n4. **imageSection** - Image with optional caption\n5. **cardGrid** - Grid of cards with configurable columns \\(2, 3, 4\\)\n6. **button** - Reusable button with style variants, sizes, themes\n7. **ctaCard** - Card with title, description, image, link\n8. **eventCard** - Event details card\n9. **investmentsCard** - Investment/partner card\n10. **bioModal** - Biography modal with person details\n11. **modalLogo** - Logo image for modal display\n12. **contentDetailModal** - Detailed content modal\n13. **collapsibleSection** - Accordion/collapsible content\n14. **newsletterSignup** - Newsletter signup form\n15. **spacer** - Whitespace/spacer component\n\n### Field Types \\(12 total\\) - Reusable Field Definitions\n\n1. **richText** - Portable text with:\n   - Block styles: normal, h1-h4, blockquote\n   - Decorators: bold, italic, underline, strike, code\n   - Lists: bullet, numbered\n   - Annotations: links\n   - Inline objects: image, video, quote, button, codeSnippet, tableBlock, newsletterSignup\n\n2. **contentSlug** - Auto-generated slug field with required current value\n\n3. **link** / **linkOptional** - See objects above \\(reused as field type\\)\n\n4. **imageWithAlt** - Image field with required alt text\n\n5. **bodyText** - Text area for body content\n\n6. **codeSnippet** - Code block with syntax highlighting support\n\n7. **video** - Video field supporting:\n   - External URL \\(YouTube, Vimeo, etc.\\)\n   - Asset upload\n   - Custom video player options\n\n8. **quote** - Quote object with:\n   - Quote text\n   - Attribution\n   - Optional image\n\n9. **stat** - Statistic component\n   - Value, label, optional icon\n\n10. **tableBlock** - Table editor with rows and columns\n\n11. **pressReleaseRichText** - Specialized richText variant for press releases\n\n12. **path** - URL path field with validation\n\n### Global Singleton Types \\(6 total\\)\n\nThese are site-wide configuration documents \\(limited to one per type\\):\n\n1. **homepage** - Homepage content and layout\n2. **navigation** - Main navigation menus configuration\n3. **footerNavigation** - Footer navigation structure\n4. **defaultSeo** - Site-wide default SEO metadata\n5. **regions** - Geographic region configuration\n6. **rlusdBalance** - RLUSD token balance data\n\n---\n\n## 6. Custom Studio Components & Customizations\n\n### Structure Customization \\(structure/index.ts\\)\n\nCustom studio navigation structure using StructureResolver:\n\n```typescript\nexport const structure: StructureResolver = \\(S\\) =>\n  S.list\\(\\)\n    .title\\(\"Base\"\\)\n    .items\\([\n      // Auto-generated document types \\(excluding singletons\\)\n      ...S.documentTypeListItems\\(\\).filter\\(\n        item => ![\n          \"defaultSeo\", \"footerNavigation\", \"homepage\",\n          \"legacyCtaCard\", \"legacyQuote\", \"legacyVideo\",\n          \"navigation\", \"redirect\", \"regions\", \"rlusdBalance\",\n          \"section\", \"settings\"\n        ].includes\\(item.getId\\(\\)\\)\n      \\),\n      S.divider\\(\\),\n      \n      // Legacy Content Section\n      S.listItem\\(\\)\n        .title\\(\"Legacy Content\"\\)\n        .id\\(\"legacyContent\"\\)\n        .icon\\(ComponentIcon\\)\n        .child\\(\n          S.list\\(\\)\n            .items\\([\n              S.documentTypeList\\(\"section\"\\),\n              S.documentTypeList\\(\"legacyVideo\"\\),\n              S.documentTypeList\\(\"legacyQuote\"\\),\n              S.documentTypeList\\(\"legacyCtaCard\"\\)\n            ]\\)\n        \\),\n      \n      S.divider\\(\\),\n      \n      // Global Options Section\n      S.listItem\\(\\)\n        .title\\(\"Global Options\"\\)\n        .icon\\(CogIcon\\)\n        .child\\(\n          S.list\\(\\)\n            .items\\([\n              S.document\\(\\).schemaType\\(\"homepage\"\\).documentId\\(\"homepage\"\\),\n              S.documentTypeList\\(\"navigation\"\\),\n              S.document\\(\\).schemaType\\(\"footerNavigation\"\\).documentId\\(\"footerNavigation\"\\),\n              S.document\\(\\).schemaType\\(\"defaultSeo\"\\).documentId\\(\"defaultSeo\"\\),\n              S.document\\(\\).schemaType\\(\"regions\"\\).documentId\\(\"regions\"\\),\n              S.document\\(\\).schemaType\\(\"rlusdBalance\"\\).documentId\\(\"rlusdBalance\"\\),\n              S.documentTypeList\\(\"redirect\"\\)\n            ]\\)\n        \\)\n    ]\\)\n```\n\n### Utility Functions\n\n**getPreviewUrl.ts** - Dynamic preview URL resolution\n- Detects environment \\(production, preview, development\\)\n- Handles Vercel deployment URLs\n- Supports localhost development\n- Parses VERCEL_RELATED_PROJECTS JSON\n- Falls back intelligently based on deployment context\n\n**getAllowOrigins.ts** - CORS origin configuration\n- Allows localhost on all environments\n- Production: adds NEXT_PUBLIC_SITE_URL\n- Preview: adds Vercel deployment URL and wildcard patterns\n\n### Plugin Usage\n\n- **media\\(\\)** - Sanity media plugin for enhanced file management\n- **visionTool\\(\\)** - GROQ query IDE for developers\n- **table\\(\\)** - Table editor for tabular data\n- **colorInput\\(\\)** - Color picker for color fields\n- **presentationTool\\(\\)** - Live preview/draft mode\n\n### Presentation Tool Configuration\n\nAdvanced integration with live preview capabilities:\n\n1. **mainDocuments** - Specifies editable content types with routes\n2. **locations** - Custom location resolvers for each document type\n3. **Dynamic Preview URLs** - Supports environment-specific URLs \\(localhost, Vercel preview, production\\)\n4. **CORS Configuration** - Environment-aware allowed origins\n\n---\n\n## 7. Algolia Search Integration\n\n### Architecture\n\nFull-stack search integration with Sanity → Algolia indexing pipeline:\n\n**Indexable Documents:**\n- page\n- blogPost\n- caseStudy\n- pressRelease\n- leadGeneration\n\n### Implementation Files\n\n**lib/algolia/**\n\n| File | Purpose | Size |\n|------|---------|------|\n| client.ts | Algolia client initialization and index management | ~200 lines |\n| transform.ts | Document transformation and text extraction | ~400 lines |\n| indexing.ts | Batch indexing with error handling | ~300 lines |\n| types.ts | TypeScript interfaces for Algolia integration | ~200 lines |\n| index.ts | Export barrel | ~40 lines |\n\n### GROQ Query Pattern\n\nFrom `scripts/algolia-sync.ts`:\n\n```groq\n*[_type in [\"page\", \"blogPost\", \"caseStudy\", \"pressRelease\", \"leadGeneration\"] \n  && !\\(_id in path\\(\"drafts.**\"\\)\\)] {\n  _id,\n  _type,\n  _createdAt,\n  _updatedAt,\n  _rev,\n  title,\n  slug,\n  path,\n  content,\n  heroTitle,\n  customerDescription,\n  goal,\n  solution,\n  summaryTitle,\n  summaryDescription,\n  eyebrowTitle,\n  body,\n  excludeFromWebsiteSearch,\n  seo,\n  \"contentType\": _type\n}\n```\n\n**Query Features:**\n- Filters to published documents only \\(excludes drafts\\)\n- Includes all searchable fields\n- Adds derived field \"contentType\"\n- Supports limit parameter for testing\n\n### Scripts \\(algolia-sync.ts\\)\n\n**Commands:**\n```bash\nnpm run algolia:sync              # Full reindex\nnpm run algolia:sync:test         # Test with LIMIT=10\nnpm run algolia:verify            # Verify index counts\nnpm run algolia:clear             # Clear Algolia index\n```\n\n**Features:**\n- Batch indexing with configurable batch size \\(500\\)\n- Document-type breakdown reporting\n- Verification against Sanity document count\n- Error tracking and reporting\n- Safe mode \\(5-second confirmation\\) for destructive operations\n\n---\n\n## 8. Data Migrations\n\n### Completed Migration\n\n**migrate-string-to-portable-text** - leadGeneration subtitle field\n\n```typescript\nMigration Logic:\n- Target: thankYouPage.subtitle field\n- Converts string field to portable text blocks\n- Splits by line breaks\n- Creates individual block paragraphs\n\nExample:\nInput:  \"Line 1\\\\nLine 2\"\nOutput: [\n  { _type: 'block', style: 'normal', children: [{ _type: 'span', text: 'Line 1' }] },\n  { _type: 'block', style: 'normal', children: [{ _type: 'span', text: 'Line 2' }] }\n]\n```\n\n---\n\n## 9. Notable Architectural Decisions\n\n### 1. Presentation Tool Integration \\(v4\\)\n- **Decision:** Implement native presentation tool instead of custom preview\n- **Benefit:** Seamless draft mode, live preview in context, reduced custom development\n- **Implementation:** Dynamic URL resolution supporting dev/staging/production\n\n### 2. Singleton Pattern for Globals\n- **Decision:** Use document ID-based singletons for site-wide settings\n- **Benefit:** Single source of truth, simple queries, prevents multiple instances\n- **IDs:** homepage, footerNavigation, defaultSeo, regions, rlusdBalance\n- **UI:** Hidden from create menu, accessed via dedicated structure items\n\n### 3. Modular Field & Component Architecture\n- **Decision:** Create reusable field/component schemas\n- **Benefit:** Consistent UX, DRY principle, easier content modeling updates\n- **Examples:** link \\(6+ variants\\), richText \\(12+ block types\\), button \\(5 variants\\)\n\n### 4. Link Field Polymorphism\n- **Decision:** Single link field handles 6 link types \\(internal/external/email/phone/file/anchor\\)\n- **Benefit:** Unified link handling across site, flexible editor UX\n- **Validation:** Type-specific required field validation\n- **Accessibility:** Built-in ariaLabel and rel attribute support\n\n### 5. Legacy Content Preservation\n- **Decision:** Keep Contentful migration schemas separate in /legacy\n- **Benefit:** Clean separation, gradual migration path, no breaking changes\n- **Structure:** 14 legacy section types, organized in dedicated UI section\n\n### 6. Content Metadata Strategy\n- **Decision:** Separate meta/publishing info into reusable object types\n- **Types:** blogMeta, publishingMeta, metaFields\n- **Fields:** author references, publishedAt, lastModified\n\n### 7. SEO as Composable Object\n- **Decision:** Create comprehensive seo object type\n- **Coverage:** Meta tags, OG, Twitter, canonical, noindex/nofollow\n- **Reusability:** Embedded in all content documents\n\n### 8. Rich Text Composition\n- **Decision:** Wrap portable text in object type to avoid nested array issues\n- **Structure:** richText object contains content array\n- **Inline Support:** Images, videos, quotes, buttons, code, tables, forms\n- **Styles:** h1-h4 headings, blockquotes, lists\n\n### 9. Multi-Environment Configuration\n- **Decision:** Environment-aware functions for preview URLs and CORS\n- **Supported Environments:** localhost, Vercel preview, production\n- **Benefits:** Single config, multi-environment support, zero env-specific code\n\n### 10. Algolia-First Search Strategy\n- **Decision:** Integrate Algolia for site search instead of Sanity search\n- **Query Pattern:** Excludes drafts, includes excludeFromWebsiteSearch flag\n- **Sync:** Full batch reindex script with verification\n- **Benefits:** Fast search, faceting, analytics, external index management\n\n### 11. Strict Schema Organization\n- **Organization:** documents/, components/, fields/, objects/, globals/, legacy/\n- **Clarity:** Clear separation of concerns\n- **Naming:** Descriptive names reflecting component type and purpose\n\n### 12. Draft Mode & Preview Integration\n- **Decision:** Use Next.js draft mode with /api/draft-mode/presentation-tool\n- **Benefit:** Unified draft experience, Next.js native support\n- **Scope:** Limited to mainDocuments \\(caseStudy, blogPost, pressRelease, leadGeneration, thankYouPage\\)\n\n---\n\n## 10. Code Metrics Summary\n\n| Metric | Value |\n|--------|-------|\n| **Total TypeScript/TSX Files** | 95 |\n| **Total Lines of Code** | ~12,974 |\n| **Schema Definition Files** | 78 |\n| **Document Types** | 16 |\n| **Component Types** | 15 |\n| **Field Types** | 12 |\n| **Object Types** | 13 |\n| **Global Singletons** | 6 |\n| **Legacy Schemas** | 14+ |\n| **Utility/Script Files** | 5+ |\n| **Package Size** | ~1.1 MB \\(with node_modules: 659 MB\\) |\n\n### Code Distribution\n- **schemaTypes/**: ~8,000+ lines \\(core schemas\\)\n- **Generated Types**: ~2,000+ lines \\(sanity.types.ts\\)\n- **Generated Schema**: Large JSON export \\(schema.json\\)\n- **Lib & Scripts**: ~1,000+ lines \\(Algolia, utilities\\)\n\n---\n\n## 11. Development Workflow\n\n### Available Scripts\n\n```json\n{\n  \"dev\": \"sanity dev\",                                    // Local development server\n  \"start\": \"sanity start\",                                // Production-like start\n  \"build\": \"npm run lint && npm run typecheck && sanity build\",  // Full build\n  \"lint\": \"npx eslint\",                                   // Code linting\n  \"typecheck\": \"tsc --noEmit\",                           // TypeScript validation\n  \"lint:fix\": \"npx eslint --fix\",                        // Auto-fix linting\n  \"deploy\": \"sanity deploy\",                              // Deploy to Sanity\n  \"deploy-graphql\": \"sanity graphql deploy\",             // Deploy GraphQL\n  \"algolia:sync\": \"dotenv -e .env -- tsx scripts/algolia-sync.ts\",\n  \"algolia:sync:test\": \"dotenv -e .env -- env LIMIT=10 tsx scripts/algolia-sync.ts\",\n  \"algolia:verify\": \"dotenv -e .env -- tsx scripts/algolia-sync.ts verify\",\n  \"algolia:clear\": \"dotenv -e .env -- tsx scripts/algolia-sync.ts clear\"\n}\n```\n\n### Build Pipeline\n1. Lint check \\(ESLint\\)\n2. Type checking \\(TypeScript\\)\n3. Sanity build \\(generates types, validates schema\\)\n4. Vercel environment variables passed to build\n\n### Environment Variables\n```\nSANITY_STUDIO_PROJECT_ID=ior4a5y3\nSANITY_STUDIO_DATASET=production\nSANITY_STUDIO_SANITY_API_VERSION=2025-11-11\nSANITY_STUDIO_VERCEL_RELATED_PROJECTS=[JSON]\nSANITY_STUDIO_VERCEL_ENV=production|preview|development\nSANITY_STUDIO_RIPPLE_APP_URL=https://ripple.com\nSANITY_API_TOKEN=<deployment_token>\nALGOLIA_APP_ID=<algolia_app_id>\nALGOLIA_ADMIN_API_KEY=<algolia_admin_key>\nALGOLIA_INDEX_NAME=prod_ripplecom_nextjs\n```\n\n---\n\n## 12. Authentication & Deployment\n\n### Authentication\n- **Provider:** Okta/SAML single sign-on\n- **URL:** https://api.sanity.io/v2021-10-01/auth/saml/login/44054204\n- **Mode:** Dual mode \\(email + SAML\\)\n- **Behavior:** Append mode \\(no override\\)\n\n### Deployment\n- **Hosting:** Sanity managed cloud \\(deployed via sanity deploy\\)\n- **CI/CD:** Vercel deployment integration\n- **Project ID:** ior4a5y3\n- **Dataset:** production\n- **GraphQL:** Available \\(deploy-graphql command\\)\n- **API Version:** 2025-11-11 \\(latest\\)\n\n---\n\n## 13. Integration Points\n\n### Frontend Integration \\(ripple-web\\)\n- **Type Safety:** Generated sanity.types.ts for full TypeScript support\n- **API:** @sanity/client for querying data\n- **Preview:** Presentation tool for draft mode\n\n### Search Integration\n- **Provider:** Algolia\n- **Indexing:** Full batch sync via scripts/algolia-sync.ts\n- **Query Pattern:** Excludes drafts, respects excludeFromWebsiteSearch flag\n\n### Presentation Tool\n- **Preview URL:** Dynamic based on Vercel environment\n- **Main Documents:** caseStudy, blogPost, pressRelease, leadGeneration\n- **Locations:** Custom preview paths for leadGeneration \\(main + thank you page\\)\n\n---\n\n## Key Takeaways\n\n1. **Modern Sanity v4 Setup** - Uses latest features \\(presentation tool, migrations, authStore\\)\n2. **Well-Organized Schema** - Clear separation: documents → components → fields → objects → globals\n3. **Production-Ready Search** - Integrated Algolia with verification and batch sync\n4. **Migration-Friendly** - Legacy schemas preserved, migration scripts in place\n5. **Multi-Environment Support** - Dynamic preview URLs for dev/staging/production\n6. **Rich Content Modeling** - Supports complex content with inline media, metadata, SEO\n7. **Type Safety** - Full TypeScript support with generated types from schema\n8. **Accessibility-First** - Link types, alt text, aria labels built into schema\n9. **Scalable Architecture** - Singleton pattern for globals, modular fields/components\n10. **Developer Experience** - Vision tool, structured navigation, clear file organization\n\n---\n\n## Recommendations for Further Enhancement\n\n1. **Webhook Integration** - Add Sanity webhooks for real-time Algolia sync instead of full batch\n2. **Content Preview Images** - Add preview image support to more components\n3. **Scheduled Publishing** - Implement scheduled publish functionality\n4. **Custom Components** - Consider React-based custom input components for complex fields\n5. **Validation Rules** - Expand cross-field validation patterns\n6. **Content Versioning** - Track content change history beyond Sanity's built-in versioning\n7. **Bulk Operations** - Add bulk edit/update scripts for content updates\n8. **Analytics Events** - Track content engagement and search metrics\n9. **Internationalization** - Prepare schema for multi-language content\n10. **Content Workflows** - Implement editorial workflows with approval stages\n\n---\n\n**End of Report**\n\nGenerated: February 11, 2026\nAnalysis Depth: Comprehensive Structural Reconnaissance\nScope: Sanity.io CMS portions only \\(Next.js frontend excluded\\)\nEOF)",
      "Bash(/Users/oppodeldoc/code/aleph-code-mine/analysis/helix-dot-com-next-structure.md << 'ANALYSIS_EOF'\n# Helix.com Next.js Repository - Structural Analysis\n\n## Project Overview\n\n**Project:** helix-dot-com-next  \n**Version:** 0.1.0  \n**Type:** Full-stack monorepo combining Next.js frontend with Sanity CMS  \n**Description:** Renders both the Next.js-based frontend UI and Sanity-based CMS \\(\"Studio\"\\) for https://www.helix.com\n\n### Tech Stack Overview\n- **Frontend Framework:** Next.js 14.0.3 with App Router\n- **Runtime:** Node.js v18.17.0 \\(specified in .nvmrc\\)\n- **Language:** TypeScript 5.0.4\n- **CMS:** Sanity 3.20.1 with Sanity Studio\n- **Package Manager:** Yarn 3.5.1\n- **React Version:** 18.2.0\n- **Styling:** SCSS modules + styled-components 6.0.0-rc.1\n- **Component Documentation:** Storybook 7.5.0\n\n---\n\n## Code Metrics\n\n### Source Code Statistics\n- **TypeScript/JavaScript Files:** 415 files\n- **Total Lines of Source Code:** ~14,068 lines\n- **Component Files \\(.tsx\\):** 188 files\n- **CSS/SCSS Files:** 75 files\n- **Sanity Schema Files:** 72 files\n\n---\n\n## Testing Setup\n\n### Current State\n- **NO Jest/Vitest configuration** detected\n- **NO Playwright/Cypress configuration** detected\n- **NO Unit/E2E testing framework installed**\n\n### Testing Infrastructure Present\n- **Storybook:** Used for component documentation and visual testing\n- **@storybook/testing-library:** For interaction testing within Storybook\n- **Husky:** Git hooks configured via prepare script\n\n---\n\n## Styling Approach\n\n### Primary Styling Methods\n\n1. **CSS Modules \\(SCSS\\)**\n   - File pattern: `*.module.scss`\n   - Found: 10+ files throughout components\n   - Used for component-scoped styling\n\n2. **Global SCSS Stylesheets**\n   - globals.scss: Main entry point with custom properties and resets\n   - Design system partials: _colors.scss, _typography.scss, _spacing.scss, _mixins.scss, _misc.scss\n\n3. **Styled Components**\n   - Version: ^6.0.0-rc.1\n   - Used for dynamic, CSS-in-JS styling\n   - Alongside CSS modules for flexibility\n\n### Design System Integration\n- **Aleph Nought Design System** \\(@aleph/nought-sass-mixins, @aleph/stylelint-config-nought\\)\n- Centralized color, typography, and spacing tokens\n- No Tailwind CSS \\(uses custom SCSS system\\)\n\n---\n\n## Notable Architectural Decisions\n\n1. **Route Groups Organization** - Clear separation between `\\(frontend\\)` and `\\(studio\\)`\n2. **Headless CMS with Static Generation** - Sanity with ISR, cache invalidation API\n3. **Dynamic Routing with Catch-All** - `[[...slug]]` for flexible content routing\n4. **Unified Search with Algolia** - Real-time search indexing\n5. **Monorepo Pattern** - Single repo contains frontend, CMS, component library\n6. **Type Safety with Sanity Codegen** - Automatic TypeScript type generation\n7. **Rich Content Building** - 40+ component blocks, Portable Text support\n8. **Advanced Component Patterns** - Storybook, CSS modules, custom hooks\n9. **Performance Optimizations** - Next.js Image optimization, bundle analyzer\n10. **Preview & Draft Mode** - Sanity preview kit for real-time editing\n\n---\n\n**Summary:** helix-dot-com-next is a sophisticated, production-grade monorepo combining Next.js 14 frontend, integrated Sanity CMS, Storybook component docs, Algolia search, type-safe code generation, and custom SCSS design system. The architecture prioritizes developer experience, content flexibility, and performance.\nANALYSIS_EOF)",
      "Bash(/Users/oppodeldoc/code/aleph-code-mine/analysis/kariusdx-next-structure.md << 'EOF'\n# Kariusdx-Next Structural Reconnaissance Report\n\n## Project Overview\n\n**Project Name:** kariusdx-next  \n**Version:** 0.1.0  \n**Type:** Next.js 12 Medical/Clinical Diagnostic Website  \n**Tech Stack:** Next.js 12.2.0, React 18.2.0, TypeScript 4.7.4, Sanity CMS\n\n**Production URL:** https://kariusdx-next.vercel.app  \n\n---\n\n## Code Metrics\n\n- **Total Files:** 338 source files\n- **Lines of Code:** ~8,144 lines \\(TypeScript/JavaScript\\)\n- **Components:** 85 TSX components\n- **Styling:** 54 SCSS modules + global styles\n- **Type Definitions:** 45+ TypeScript definition files\n- **Sanity Queries:** 14+ GROQ query files\n\n---\n\n## Testing Setup\n\n**Status:** NO TESTING FRAMEWORK DETECTED\n\n- No Jest, Vitest, Playwright, or Cypress configuration\n- No test files found\n- No testing dependencies in package.json\n\n**Gap:** Production site with 85 components and complex data fetching but no unit/integration/E2E tests.\n\n---\n\n## Styling Approach: SCSS WITH CSS MODULES\n\n**Architecture:**\n- CSS Modules for component scoping\n- Global SCSS imports\n- SCSS variables, mixins, and utility functions\n- BEM-like naming convention\n\n**No:** Tailwind CSS, styled-components, Emotion, or inline styles\n\n---\n\n## Routing Structure\n\n**Pages Router \\(Next.js 12\\):**\n- pages/_app.tsx: Global layout wrapper\n- pages/[...slug]/index.tsx: **Catch-all dynamic pages** \\(main content from Sanity\\)\n- Supports nested URLs like `/about-us/licensure`\n- Server-side rendering with preview mode support\n\n---\n\n## Sanity CMS Integration\n\n**Architecture:**\n- Headless CMS for content management\n- GROQ queries for data fetching\n- Dual clients: Production \\(CDN\\) + Preview \\(draft support\\)\n\n**Content Blocks \\(Page Builder Pattern\\):**\n- Dynamic component rendering via `PageContent` component\n- Type-safe block mapping\n- Supports: ImageCarousel, ClinicalData, FAQ, NewsGrid, etc.\n\n---\n\n## Notable Architectural Patterns\n\n1. **Page Builder Pattern** - Sanity-driven page composition with reusable content blocks\n2. **Preview Mode Implementation** - withPreview HOC for draft content\n3. **Modular Component Architecture** - Folder-per-component with colocated styles\n4. **Security Headers** - CORS, CSP with Sanity whitelisting\n5. **URL Redirects** - 20+ permanent/temporary redirects for legacy URLs\n6. **Data Filtering & State** - Clinical Data filters with URL parameters\n7. **Performance Optimizations** - Dynamic imports, bundle analyzer, Sanity CDN\n8. **SEO Implementation** - next-seo integration, sitemap generation\n9. **Third-party Integrations** - HubSpot, Wistia, Google Maps, Algolia\n10. **Type Safety** - Strict TypeScript mode with 45+ custom type definitions\n\n---\n\n**Summary:** Mature, well-structured Next.js 12 medical website using Sanity CMS with comprehensive component library \\(85+ components\\), strong TypeScript typing, SCSS-based styling, and security-conscious architecture. Main gap: absence of automated testing.\nEOF)",
      "Bash(/Users/oppodeldoc/code/aleph-code-mine/analysis/policy-node-structure.md << 'EOF'\n# Policy-Node \\(Airbnb Policy Site\\) - Structural Analysis\n\n## Project Overview\n\n**Name:** airbnb-policy-site  \n**Type:** Next.js 15 Application \\(Headless WordPress CMS\\)  \n**Version:** 0.1.0  \n**Tech Stack:** Next.js 15.5.10, React 19.0.0, TypeScript 5.7.3, WordPress VIP GraphQL\n\n---\n\n## Code Metrics\n\n- **Total Source Files:** 431\n- **TypeScript/TSX Lines:** ~29,501 LOC\n- **SCSS Lines:** ~4,536 LOC\n- **React Components:** 40+\n- **Build Cache System:** 2,806 LOC \\(dedicated\\)\n\n---\n\n## Testing Setup\n\n**Current Status:** NO formal test framework configured\n\n- No Jest, Vitest, Playwright, or Cypress\n\n**Validation Strategy:**\n- Data validation scripts \\(validate-data.ts\\)\n- Manual testing scripts in /scripts\n\n---\n\n## Styling Approach\n\n**Methodology:** CSS Modules with SCSS \\(Sass\\)\n\n**Characteristics:**\n1. **Global Styles:** globals.scss with resets, typography, print styles\n2. **Component Styles:** Each component has `*.module.scss` \\(scoped\\)\n3. **Design System:** @aleph/nought-sass-mixins with variables\n4. **Features:** Print-friendly, responsive, accessible focus states\n5. **Linting:** Stylelint with pre-commit hooks\n\n**No Tailwind or Styled-Components** - Pure CSS Modules approach\n\n---\n\n## Notable Architectural Decisions\n\n1. **ISR with Redis** - Custom cache handler for Next.js 15 with cross-instance cache sharing\n2. **Language/i18n Architecture** - URL-based routing: `/[lang]/[...slug]`\n3. **CSV Data Pipeline** - S3 as single source of truth, ~190MB data downloads, automated hourly GitHub Actions\n4. **WordPress Integration** - GraphQL API with 60s+ timeout handling, preview routes\n5. **Performance Optimizations** - Build-time caching \\(2.8K LOC\\), search index pre-generation, ~13,800 pages built\n6. **Search Architecture** - Fuse.js for fuzzy search with pre-generated indices\n7. **API Routes** - /api/metrics, /api/phrases, /api/cache \\(authenticated\\)\n8. **Deployment Strategy** - WordPress VIP hosting with branch → environment mapping\n9. **Multi-Environment Support** - VIP production with Redis, local with S3 cache\n10. **Git Workflow** - GitHub Actions CI/CD, Husky hooks, auto-generated data update PRs\n\n---\n\n**Summary:** Sophisticated, production-grade Next.js 15 application designed for high-traffic, multi-language content delivery with complex data pipelines \\(CSV from S3\\), Redis ISR caching, and WordPress VIP headless integration. Emphasis on caching at multiple levels and automated data management.\nEOF)",
      "Bash(/Users/oppodeldoc/code/aleph-code-mine/analysis/helix-dot-com-sanity-structure.md << 'EOF'\n# Helix-dot-com-sanity - Structural Analysis\n\n## Project Overview\n\n**Project:** helix-dot-com-sanity  \n**Type:** Sanity Studio v3 for Helix website  \n**Version:** Sanity 3.10.0  \n**Package Manager:** Yarn 3.5.1  \n**Deployment:** Vercel \\(staging & production branches\\)\n\n---\n\n## Key Statistics\n\n- **Total Code:** 297 lines \\(excluding dependencies\\)\n- **TypeScript:** Enabled with strict mode\n- **Schema Files:** 4 types \\(2 documents, 2 objects\\)\n\n---\n\n## Schema Organization\n\n**Documents \\(2\\):**\n1. **Page** \\(60 lines\\) - Hierarchical pages with parent references and async slug generation\n2. **Blog Post** \\(91 lines\\) - Name, subheader, featured image, rich content\n\n**Objects \\(2\\):**\n1. **Featured Image** \\(15 lines\\) - Image with hotspot\n2. **SEO Fields** \\(67 lines\\) - Keywords, title, description, canonical URL, OpenGraph, noindex/nofollow\n\n---\n\n## Custom Logic\n\n**Slug Validation:** isUniqueAcrossAllDocuments.js - GROQ query ensuring global slug uniqueness\n\n**Hierarchical Slug Generation:** Fetches parent, appends current title \\(e.g., parent-slug/child-slug\\)\n\n---\n\n## Content Modeling Patterns\n\n- **Hierarchical Pages** - Self-referential parent-child structure\n- **Slug Management** - Auto-generated with async uniqueness checks\n- **SEO-First** - Dedicated object with OpenGraph + search engine controls\n- **Reusable Objects** - Featured Image and SEO Fields as shared components\n- **Conditional Fields** - showHeroSubheader boolean controls subheader visibility\n- **Grouped UI** - Blog post separates content from settings\n\n---\n\n## Notable Architectural Decisions\n\n1. **Minimal schema \\(4 types\\)** - Focused MVP approach\n2. **Async GROQ validation** - Ensures data integrity\n3. **No custom studio components** - Uses default Sanity UI\n4. **Environment-driven config** - Supports multiple deployments\n5. **Staging/production datasets** with documented sync\n6. **disableNew on page references** - Enforces existing selection\n7. **Hierarchical slugs with parent awareness**\n8. **Field groups improve editor UX**\n\n---\n\n## Strengths & Enhancement Opportunities\n\n**Strengths:**\n✅ Clean, modular schema organization  \n✅ Comprehensive SEO configuration  \n✅ Hierarchical page support with smart slugs  \n✅ Type-safe TypeScript throughout  \n✅ Follows Sanity best practices\n\n**Enhancement Opportunities:**\n⚠️ No preview configurations \\(frontend preview URLs\\)  \n⚠️ No custom desk structure \\(linear document view\\)  \n⚠️ Limited validation \\(only slug uniqueness\\)  \n⚠️ No i18n/localization  \n⚠️ No custom input components\n\n---\n\n**Summary:** Minimal, well-structured Sanity Studio v3 with 4 schema types \\(297 LOC\\), hierarchical pages, comprehensive SEO support, and async slug validation. Clean MVP approach with room for enhancement in preview configs and custom desk structure.\nEOF)",
      "Bash(/Users/oppodeldoc/code/aleph-code-mine/analysis/kariusdx-sanity-structure.md << 'EOF'\n# Kariusdx Sanity Studio - Structural Analysis\n\n## Project Overview\n\n**Name:** Darkblue Lark \\(Karius Project\\)  \n**Sanity Version:** v2.30.0  \n**Purpose:** Headless CMS for Karius DX diagnostic testing platform  \n**Project ID:** nj4jfuv6  \n**Dataset:** production \\(staging in development\\)\n\n---\n\n## Code Metrics\n\n- **Schema Files:** 64 JS files\n- **Total LOC:** 4,270 lines\n- **Document Types:** 11\n- **Builder Blocks:** 22 reusable content sections\n- **Object Types:** 23 reusable objects\n- **Custom Fields:** 8\n\n---\n\n## Document Types \\(11 Total\\)\n\n1. **page** - Main content pages with page builder, SEO, hero section, FAQs\n2. **news** - News/press articles with featured image\n3. **pressRelease** - Press releases with SEO pane\n4. **clinicalEvidence** - Complex domain-specific schema \\(study/trial/abstract/article/case\\)\n5. **pathogen** - Microbiology taxonomy \\(Bacteria, Fungi, Viruses, etc.\\)\n6. **staff** - Team member profiles with headshot and bio\n7. **video** - Video content with SEO\n8. **event** - Event management\n9. **navigation** - Navigation tree structure\n10. **navigationMenu** - Menu configuration\n11. **siteSettings** - Global site config \\(social, footer, announcements\\)\n\n---\n\n## Builder Blocks \\(22\\)\n\n**Layout:** pageSection, columns, imageColumnsCard  \n**Content:** richText, button, styledLink, horizontalRule  \n**Media:** imageCarousel, imageTextCarousel, imageTextLockup  \n**Data:** stats, wideCards, processCards, comparisonSection, diagnosisComparison  \n**Domain-Specific:** staffGrid, pathogenList, clinicalApplications, jobPostings, resourceContentGrid  \n**Integrations:** hubspotForm, wistiaEmbed, googleMapsEmbed\n\n---\n\n## Schema Organization Approach\n\n**Modular Architecture:**\n- Centralized imports in schema.js \\(140 lines\\)\n- Separated concerns: documents, builderBlocks, objects, fields, globals\n- Reusable object and field types prevent duplication\n- Groups within documents organize related fields\n\n**Validation Strategy:**\n- Field-level `.required\\(\\)` rules\n- Custom validation for conditional fields\n- Unique value validation\n- HTML ID validation \\(no spaces\\)\n\n**Conditional Field Logic:**\n- `hidden\\(\\)` functions based on parent/sibling values\n- Dynamic field visibility based on document type\n\n---\n\n## Custom Components & Plugins\n\n**Custom Components:** logo.js - Inline Karius SVG logo\n\n**Custom Plugins:** CustomDefaultLayout, Desk Structure Plugin\n\n**Panes & Views:** Iframe preview, SEO Tools pane \\(Yoast-like\\), Form view\n\n---\n\n## Architectural Decisions\n\n1. **Hierarchical Page Structure** - Parent-child relationships, automatic path generation\n2. **Content Modeling for Domain Specificity** - Clinical evidence with conditional fields\n3. **Preview & Production Integration** - TOTP-based preview URLs \\(hourly rotation\\)\n4. **Custom Action System** - SetSlugAndPublishAction handles slug generation and cascading updates\n5. **SEO-First Approach** - Dedicated SEO object with canonical URL, OpenGraph, meta\n6. **Color System & Branding** - 22 brand colors with React components\n7. **Medical Domain Optimization** - Clinical evidence taxonomy, pathogen classification\n\n---\n\n**Summary:** Complex, production-ready Sanity v2 Studio with 64 schemas \\(4,270 LOC\\) tailored for medical/diagnostic domain. Features hierarchical pages, 22 content blocks, custom preview system with TOTP security, comprehensive clinical evidence taxonomy, and SEO-first approach. Highly specialized for medical content management.\nEOF)",
      "Bash(/Users/oppodeldoc/code/aleph-code-mine/analysis/ripplecom-sanity-structure.md << 'EOF'\n# Ripplecom-Nextjs \\(Sanity\\) - Structural Analysis\n\n## Project Overview\n\n**Repository Location:** Sanity Studio at `/apps/sanity-studio` in monorepo  \n**Monorepo Type:** Turbo-based multi-app workspace  \n**Sanity Version:** 4.3.0 \\(latest stable\\)\n\n---\n\n## Code Metrics\n\n- **Schema Files:** 78 across 95 TypeScript files\n- **Total LOC:** ~12,974 lines \\(Sanity-specific only\\)\n- **Document Types:** 16\n- **Component Types:** 15 \\(reusable UI blocks\\)\n- **Object Types:** 13 \\(embedded data structures\\)\n- **Global Singletons:** 6 \\(site-wide configuration\\)\n\n---\n\n## Content Architecture\n\n**16 Document Types:**\n- Core: blogPost, caseStudy, pressRelease, page, leadGeneration, thankYouPage, event, person\n- Categories: category, tag, pageSubnav, redirect\n- Legacy: legacyCtaCard, legacyQuote, legacyVideo, section \\(Contentful migration\\)\n\n**15 Component Types:**\n- heroSection, ctaSection, textSection, imageSection, cardGrid, button, ctaCard\n- eventCard, investmentsCard, bioModal, modalLogo, contentDetailModal, collapsibleSection, newsletterSignup, spacer\n\n**13 Object Types:**\n- seo \\(comprehensive meta\\), link \\(6 variants\\), blogMeta, publishingMeta, navigationItem/Column/Dropdown\n- contactInfo, country, footerSection, hoverLayoutItem, valueProps\n\n**6 Global Singletons:**\n- homepage, navigation, footerNavigation, defaultSeo, regions, rlusdBalance\n\n---\n\n## Key Dependencies\n\n| Package | Version | Purpose |\n|---------|---------|---------|\n| sanity | ^4.3.0 | Core CMS |\n| @sanity/client | ^7.12.0 | API client |\n| sanity-plugin-media | ^4.0.0 | Enhanced media |\n| algoliasearch | ^4.24.0 | Search indexing |\n\n---\n\n## Notable Features\n\n1. **Presentation Tool Integration** - Live draft preview with dynamic URL resolution\n2. **Algolia Search** - Full-stack integration with batch indexing \\(5 content types\\)\n3. **Link Field Polymorphism** - Single field handling 6 link types \\(internal/external/email/phone/file/anchor\\)\n4. **Rich Text Composition** - Portable text supporting inline media \\(images, videos, quotes, buttons, code, tables, forms\\)\n5. **Legacy Content Preservation** - 14 legacy Contentful schemas for gradual migration\n6. **Multi-Environment Configuration** - Environment-aware functions for preview URLs and CORS\n7. **Okta/SAML Authentication** - Enterprise SSO integration\n\n---\n\n## Architectural Patterns\n\n1. **Singleton Pattern** - Document IDs for single-instance globals \\(no \"create new\"\\)\n2. **Modular Fields** - Reusable field schemas prevent duplication\n3. **SEO-First** - Comprehensive SEO object in all content\n4. **Type Safety** - Full TypeScript with 48KB generated types\n5. **Draft Mode** - Native Next.js draft integration\n\n---\n\n## Integration Points\n\n- **Search:** Algolia with full batch sync\n- **Preview:** Presentation tool with location-based routing\n- **Frontend:** Generated types exported to Next.js app\n- **Authentication:** Okta SAML, dual-mode \\(email + SAML\\)\n\n---\n\n**Summary:** Sophisticated Sanity v4 studio in monorepo with 78 schemas \\(12,974 LOC\\), Algolia search integration, Presentation Tool for preview, legacy Contentful migration support, and Okta SAML authentication. Most complex Sanity implementation across all repos with polymorphic link fields and comprehensive type safety.\nEOF)",
      "Bash(/Users/oppodeldoc/code/aleph-code-mine/analysis/thekelsey-wp-structure.md << 'EOF'\n# The Kelsey WordPress Site - Structural Analysis\n\n## Project Overview\n\n**Site Name:** The Kelsey \\(thekelsey.org\\)  \n**Project Type:** Bedrock-based WordPress Site  \n**Base Framework:** Bedrock \\(Roots modern WordPress development stack\\)  \n**Theme:** Sage 9 with Blade templating\n\n---\n\n## Code Metrics\n\n- **Total Project Size:** 318 MB\n- **PHP Lines:** 352,025 LOC\n- **JavaScript Lines:** 247,359 LOC\n- **Theme Size:** 270 MB \\(built assets + node_modules\\)\n- **Custom Components:** 60+ Blade partials\n- **Page Templates:** 16 custom templates\n- **Custom Post Types:** 3 \\(Projects, Events, Resources\\)\n- **Custom Gutenberg Blocks:** 15+\n- **ACF Field Groups:** 20+\n\n---\n\n## Custom Themes\n\n### Kelsey Theme \\(Sage 9\\)\n\n**Tech Stack:**\n- Blade templating \\(Laravel-based\\)\n- Webpack 3.x with BrowserSync\n- SCSS with CSS modules\n- PSR-4 autoloading\n- Controller pattern for data passing\n\n**Structure:**\n- app/ - PHP theme logic \\(Controllers\\)\n- resources/ - Assets, views \\(Blade templates\\), functions\n- dist/ - Compiled assets\n- 16 custom page templates\n- 9 custom block templates\n\n---\n\n## Must-Use Plugins\n\n1. **The Kelsey Custom Plugin** - Custom post types, taxonomies, ACF integration\n2. **The Kelsey Blocks** - Custom Gutenberg blocks \\(cgb-scripts\\)\n3. **Advanced Custom Fields Pro** - Premium field management\n4. **Bedrock Autoloader** - Roots utility for plugin loading\n5. **Disallow Indexing** - Security utility\n\n---\n\n## Configuration Patterns\n\n**Environment Management:**\n- .env file \\(not in repo\\)\n- WP_ENV \\(production/development/edge\\)\n- GCP Cache integration \\(Redis-like\\)\n- S3/GCP storage for assets\n\n**Coding Standards:**\n- PHPCS: PSR-2 standard\n- Theme PSR-2 with Blade-specific relaxations\n- VIP-compliant code\n\n---\n\n## Notable Architectural Decisions\n\n1. **Bedrock Foundation** - Modern WordPress dev structure, separates core from app code\n2. **Sage 9 Theme** - Laravel Blade templating, MVC-inspired controllers\n3. **Must-Use Plugins Strategy** - ACF Pro + custom code in mu-plugins\n4. **Custom Post Types** - Projects, Events, Resources with REST API\n5. **ACF Field Organization** - JSON-based field groups \\(version controlled\\)\n6. **Block-First CMS** - 15+ custom Gutenberg blocks\n7. **Third-Party Integration** - Funraise \\(donations\\), Yoast SEO, Contact Form 7\n8. **Multi-Environment Setup** - Production, edge \\(staging\\), development\n9. **Responsive Image Strategy** - 18 custom image sizes\n10. **CSS-in-JS Free** - Sage/Webpack-based Sass compilation\n\n---\n\n**Summary:** Sophisticated Bedrock-based WordPress with Sage 9 theme \\(352,025 LOC PHP\\), Blade templating, Webpack build system, 3 custom post types, 16 page templates, 15+ Gutenberg blocks, and ACF Pro for flexible content. Modern WordPress development practices with proper separation of concerns and multi-environment support.\nEOF)",
      "Bash(/Users/oppodeldoc/code/aleph-code-mine/analysis/airbnb-structure.md << 'EOF'\n# Airbnb WordPress VIP Multisite - Structural Analysis\n\n## Project Overview\n\n**Type:** WordPress VIP Go Multisite \\(8+ production sites\\)  \n**Sites:** Newsroom, Tech Blog, Careers, Real Estate, Admin Dashboard, Olympics, DLS Blog, Policy  \n**Repository:** GitHub \\(wpcomvip organization\\)  \n**Target WP Version:** 6.7+ \\(PHP 8.1-8.2\\)\n\n---\n\n## Code Metrics\n\n- **PHP Files:** 12,526\n- **JavaScript Files:** 26,157\n- **Total Size:** ~150MB+ \\(excluding node_modules\\)\n- **Themes:** 14 \\(custom + stock\\)\n- **Plugins:** 50 \\(mix of custom, premium, open-source\\)\n\n---\n\n## Custom Themes \\(14\\)\n\n**Primary Active:**\n1. **presser** \\(Newsroom\\) - Roots Sage, Webpack 5, Preact, Three.js, Lottie\n2. **airbnbtech** \\(Tech Blog\\) - Traditional PHP functions.php\n3. **airbnb-careers** \\(Careers\\) - Custom blocks\n4. **a4re** - Real estate\n5. **protools** - Admin tools\n6. **onboard** - Onboarding\n7. **Other specialized themes** - Olympics, DLS blog, rentals\n\n---\n\n## Key Plugins \\(50\\)\n\n**Custom:**\n- airbnb-policy-blocks \\(12 custom + 15 ACF blocks\\)\n- airbnb-custom-post-types \\(6+ post types\\)\n- presser-custom-mods \\(5.6MB with Symfony\\)\n- Gutenberg block plugins \\(careers, press, protools, rkv\\)\n\n**Premium:**\n- Advanced Custom Fields Pro \\(24MB\\)\n- Polylang Pro \\(5.4MB\\) - i18n\n- FacetwP \\(1.3MB\\) - Search\n- WPBakery JS Composer \\(21MB\\)\n- Yoast SEO \\(18MB\\)\n\n**Editor:** Edit-Flow \\(2.3MB\\), fieldmanager\n\n**API:** wpgraphql-acf, vip-block-data-api, wp-graphql-polylang\n\n**Integrations:** Google Site Kit, Onelogin SAML SSO, Greenhouse Jobs API\n\n---\n\n## Must-Use Plugins\n\n1. **plugin-loader.php** - Conditional plugin loading by blog_id\n2. **graphql-security.php** - DoS prevention \\(10KB query limit, 500 complexity max\\)\n3. **disable-yoast-author-indexer.php** - Performance optimization\n4. **decoupled-bundle-loader.php** - Headless frontend support\n5. **vip-decoupled-bundle/** - Headless CMS utilities\n6. **vipgo-helper.php** - VIP Go platform utilities\n\n---\n\n## Configuration & Standards\n\n**PHPCS Configuration:**\n- Standards: WordPress VIP Minimum + VIP Go + PSR2\n- Indentation: 4-space tabs\n- Line Length: No hard limit\n- Scans: themes/airbnbtech, themes/presser\n\n**Build Tools:**\n- Webpack 5 \\(presser theme\\)\n- wp-scripts \\(policy-blocks\\)\n- npm/yarn with 1080+ packages\n\n---\n\n## Notable Architectural Decisions\n\n1. **Multisite Organization** - Single codebase serves 8+ sites with branch-per-environment\n2. **Headless/Decoupled Support** - vip-decoupled-bundle + GraphQL API\n3. **GraphQL-First Architecture** - Query size/complexity protection, wpgraphql + ACF\n4. **Sage Framework** - Modern PHP with namespaces, Blade templating, Controllers\n5. **ACF for Content** - ACF Pro with JSON storage, site-specific blocks\n6. **Premium Plugin Stack** - ACF Pro, Polylang Pro, FacetwP, Yoast SEO\n7. **Language/Translation** - 215+ language directories, Polylang Pro\n8. **Security Hardening** - VIP Code Sniffer, GraphQL limits, SAML SSO\n9. **Content Syndication** - Facebook Instant Articles, Twitter API\n10. **Development Workflow** - VIP Lando locally, multi-branch deployment \\(develop → staging, master → production\\)\n\n---\n\n## Technology Stack\n\n| Layer | Technology |\n|-------|-----------|\n| **CMS** | WordPress VIP Go Multisite 6.7+ |\n| **PHP** | 8.1-8.2 |\n| **Primary Theme** | Roots Sage \\(presser\\) |\n| **Template Engine** | Blade \\(Laravel\\) |\n| **JS Build** | Webpack 5, Babel 7 |\n| **CSS** | SCSS → PostCSS |\n| **JS Framework** | Preact \\(presser\\) |\n| **Content Fields** | ACF Pro + Fieldmanager |\n| **API** | GraphQL \\(WP GraphQL\\) + REST |\n| **SEO** | Yoast SEO |\n| **Multilingual** | Polylang Pro |\n| **Search** | FacetwP |\n| **Page Builder** | Gutenberg + WPBakery \\(legacy\\) |\n| **Auth** | Onelogin SAML SSO |\n| **Code Standards** | PHPCS \\(VIP WordPress\\) + ESLint + StyleLint |\n\n---\n\n**Summary:** Large-scale WordPress VIP Go multisite \\(8+ production sites\\) with 14 custom themes, 50 plugins, GraphQL-first headless architecture, Sage framework with Blade templating, Webpack 5 build system, Polylang Pro for i18n, and comprehensive security hardening. Serves Airbnb Newsroom, Tech Blog, Careers, and multiple specialized sites from single codebase.\nEOF)",
      "Bash(__NEW_LINE_ca764a273b8fac0f__ echo \"\")",
      "Bash(__NEW_LINE_c9427d8f78e9208a__ echo \"=== POLICY-NODE: async function components ===\")",
      "Bash(__NEW_LINE_4e334ab22f32bd69__ echo \"\")",
      "Bash(__NEW_LINE_41385c75173496a6__ echo \"\")",
      "Bash(__NEW_LINE_4d870b04dd12435a__ echo \"\")",
      "Bash(# More precise: check export default patterns echo \"\"=== HELIX: export patterns ===\"\" echo \"\"export default function:\"\" find /Users/oppodeldoc/code/helix-dot-com-next/app -name ''*.tsx'' -not -path ''*/node_modules/*'' -not -name ''*.stories.tsx'' -exec grep -c ''export default function'' {} +)",
      "Bash(__NEW_LINE_727089ddcf520200__ echo \"\")",
      "Bash(# Count I-prefix pattern vs XProps pattern in kariusdx echo \"\"=== KARIUSDX: I-prefix interface/type count ===\"\" find /Users/oppodeldoc/code/kariusdx-next -name ''*.tsx'' -not -path ''*/node_modules/*'' -exec grep -c ''interface I[A-Z]\\\\|type I[A-Z]'' {} +)",
      "Bash(__NEW_LINE_d7653332d2a2f1be__ echo \"\")",
      "Bash(__NEW_LINE_0c133834eabcb8a1__ echo \"\")",
      "Bash(__NEW_LINE_757531c1a4c00ae9__ echo \"\")",
      "Bash(__NEW_LINE_b09c8d00e593309d__ echo \"\")",
      "Bash(__NEW_LINE_77544f11c9e6f41e__ echo \"\")",
      "Bash(test:*)",
      "Bash(xargs rg:*)"
    ]
  }
}
