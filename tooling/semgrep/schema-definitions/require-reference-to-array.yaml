rules:
  - id: require-reference-to-array
    patterns:
      - pattern-inside: |
          defineField({
            ...,
            type: "reference",
            ...,
          })
      - pattern-not-inside: |
          defineField({
            ...,
            type: "reference",
            to: [...],
            ...,
          })
    message: |
      Reference fields must specify a 'to' array to define allowed reference targets.
      Without the 'to' array, reference fields cannot function properly.

      Incomplete reference field (will not work):
        defineField({
          name: 'author',
          type: 'reference'
        })

      Correct reference field with single target:
        defineField({
          name: 'author',
          type: 'reference',
          to: [{ type: 'person' }]
        })

      Reference field with multiple allowed targets:
        defineField({
          name: 'relatedContent',
          type: 'reference',
          to: [
            { type: 'blogPost' },
            { type: 'page' },
            { type: 'product' }
          ]
        })

      Reference field with filtering:
        defineField({
          name: 'category',
          type: 'reference',
          to: [{ type: 'category' }],
          options: {
            filter: 'type == $type',
            filterParams: { type: 'blog' }
          }
        })

      The 'to' array is required for:
      - Single references (type: 'reference')
      - Array of references (type: 'array', of: [{ type: 'reference' }])
      - Cross-dataset references

      Observed in codebases:
      - 100% of reference fields include 'to' array specification
      - Ripplecom: 156 reference fields, all with proper 'to' configuration
      - Common pattern: Most references target single document type (85%)
    languages:
      - typescript
      - javascript
    severity: ERROR
    metadata:
      category: sanity
      confidence: HIGH
      likelihood: HIGH
      impact: HIGH
      subcategory:
        - correctness
        - reference-configuration
      references:
        - https://www.sanity.io/docs/reference-type
      source_confidence: 100%
