rules:
  - id: warn-missing-preview-config
    patterns:
      - pattern-inside: |
          defineType({
            ...,
            type: "document",
            ...,
          })
      - pattern-not-inside: |
          defineType({
            ...,
            preview: {
              ...,
            },
            ...,
          })
    message: |
      Document schemas should include a preview configuration.
      Preview configurations improve the Studio user experience by showing meaningful
      document representations in lists and references.

      Missing preview configuration means users see generic document representations
      instead of helpful titles, descriptions, and media.

      Add preview configuration:
        import { defineType, defineField } from "sanity"

        export default defineType({
          name: 'blogPost',
          type: 'document',
          fields: [
            defineField({ name: 'title', type: 'string' }),
            defineField({ name: 'mainImage', type: 'image' }),
            defineField({ name: 'excerpt', type: 'text' })
          ],
          preview: {
            select: {
              title: 'title',
              subtitle: 'excerpt',
              media: 'mainImage'
            }
          }
        })

      Advanced preview with computed values:
        preview: {
          select: {
            title: 'title',
            author: 'author.name',
            date: 'publishedAt'
          },
          prepare({ title, author, date }) {
            return {
              title,
              subtitle: `${author} â€¢ ${new Date(date).toLocaleDateString()}`
            }
          }
        }

      Adoption in analyzed codebases:
      - Ripplecom (v4): 57% of document schemas (44 of 77 schemas)
      - Helix (v3): 75% of document schemas (3 of 4 schemas)
      - Kariusdx (v2): 34% of document schemas (23 of 68 schemas)
    languages:
      - typescript
      - javascript
    severity: INFO
    metadata:
      category: sanity
      confidence: MEDIUM
      likelihood: MEDIUM
      impact: MEDIUM
      subcategory:
        - ux
        - studio-experience
      references:
        - https://www.sanity.io/docs/previews-list-views
      source_confidence: 52%
