rules:
  - id: hardcoded-api-key-pattern
    patterns:
      - pattern-either:
          - pattern: |
              const $VAR = "$VALUE"
          - pattern: |
              $VAR = "$VALUE"
      - metavariable-regex:
          metavariable: $VAR
          regex: .*(api[_-]?key|secret|password|token|auth).*
      - metavariable-regex:
          metavariable: $VALUE
          regex: ^[a-zA-Z0-9_\-]{20,}$
    message: |
      Potential hardcoded secret detected in variable name containing "api_key", "secret", "password", or "token".

      Use environment variables instead:
        const apiKey = process.env.API_KEY;
        const secret = process.env.INTERNAL_API_SECRET;

      Never commit secrets to version control.
    severity: ERROR
    languages: [javascript, typescript, python, php]
    metadata:
      category: security
      confidence: MEDIUM
      impact: HIGH

  - id: next-public-prefix-on-secret
    pattern: NEXT_PUBLIC_$SECRET
    metavariable-regex:
      metavariable: $SECRET
      regex: .*(SECRET|PASSWORD|KEY|TOKEN).*
    message: |
      NEXT_PUBLIC_ prefix exposes variable to browser JavaScript.
      Variable name suggests this is a secret.

      Remove NEXT_PUBLIC_ prefix for server-only access:
        ❌ NEXT_PUBLIC_API_SECRET="..."  # Exposed to browser!
        ✅ API_SECRET="..."              # Server-only
    severity: ERROR
    languages: [text]
    paths:
      include:
        - "*.env*"
        - ".env"
    metadata:
      category: security
      confidence: HIGH
      impact: CRITICAL

  - id: committed-env-local-file
    patterns:
      - pattern: |
          /.env.local
      - pattern-not: |
          !/.env.local
    message: |
      .env.local file should be in .gitignore, not committed.
      This file typically contains local secrets and overrides.

      Add to .gitignore:
        .env.local
        .env*.local
    severity: WARNING
    languages: [text]
    paths:
      include:
        - ".gitignore"
    metadata:
      category: security
      confidence: HIGH
